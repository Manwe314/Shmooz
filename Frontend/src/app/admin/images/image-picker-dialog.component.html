<h2 mat-dialog-title>Choose image</h2>
<div mat-dialog-content>
  <mat-tab-group>
    <mat-tab label="Gallery">
      <div class="gallery">
        <div class="thumb" *ngFor="let img of images" (click)="choose(img)" [title]="img.title">
          <img [src]="toFullUrl(img.image)" [alt]="img.title" />
          <div class="caption">{{ img.title }} (#{{ img.id }})</div>
        </div>
      </div>
      <div class="pager">
        <button mat-stroked-button (click)="prevPage()" [disabled]="pageOffset === 0 || loading()">Prev</button>
        <span>&nbsp; Page {{ pageOffset / limit + 1 }} </span>
        <button mat-stroked-button (click)="nextPage()" [disabled]="!hasNext() || loading()">Next</button>
        <mat-progress-spinner *ngIf="loading()" diameter="18" mode="indeterminate"></mat-progress-spinner>
      </div>
    </mat-tab>
    <mat-tab label="Upload">
      <div class="upload">
        <mat-form-field appearance="fill" class="w">
          <mat-label>Title</mat-label>
          <input matInput [(ngModel)]="uploadTitle" />
        </mat-form-field>

        <div class="file-input-container">
          <input
            type="file"
            (change)="onFile($event)"
            accept="image/*"
            title="Select an image file (max {{ getMaxFileSizeMB() }}MB)" />
          <div class="file-info">
            <small class="file-limit-info">Maximum file size: {{ getMaxFileSizeMB() }}MB • Supported formats: JPEG, PNG, GIF, WebP</small>
          </div>
        </div>

        @if (fileError()) {
          <div class="error-message">
            <mat-icon color="warn">error</mat-icon>
            <span>{{ fileError() }}</span>
          </div>
        }

        <button
          mat-flat-button
          color="primary"
          (click)="doUpload()"
          [disabled]="!file || !uploadTitle || uploading() || fileError()">
          {{ uploading() ? 'Uploading…' : 'Upload' }}
        </button>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
<div mat-dialog-actions align="end">
  <button mat-button (click)="ref.close()">Close</button>
</div>
