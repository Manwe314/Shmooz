<mat-card class="pcard-card" *ngIf="owner(); else noSlug">
  <div class="header">
    <h2>Project Cards</h2>
    <span class="owner">Owner: <strong>{{ owner() }}</strong></span>
    <span class="spacer"></span>

    <!-- Deck picker -->
    <mat-form-field appearance="fill" class="deckSelect">
      <mat-label>Deck</mat-label>
      <mat-select [value]="selectedDeckId()" (valueChange)="onDeckChange($event)">
        <mat-option [value]="null">— Select deck —</mat-option>
        <mat-option *ngFor="let d of decks()" [value]="d.id">
          {{ d.displayed_name || d.title }} (id: {{ d.id }})
        </mat-option>
      </mat-select>
    </mat-form-field>

    <button mat-flat-button color="primary" (click)="newCard()" [disabled]="!selectedDeckId()">New card</button>
  </div>

  <div class="layout">
    <!-- Left: list -->
    <div class="list">
      <h3>Existing cards</h3>
      <mat-nav-list>
        <a mat-list-item *ngFor="let c of cards()" (click)="loadCard(c)">
          <span matListItemTitle>{{ c.title }}</span>
          <span matListItemLine>Edited: {{ c.edited_at || c.created_at | date:'short' }}</span>
        </a>
      </mat-nav-list>
    </div>

    <!-- Right: form + preview -->
    <div class="formWrap" [class.disabled]="!selectedDeckId()">
      <form [formGroup]="form" (ngSubmit)="save()">
        <div class="grid">
          <mat-form-field appearance="fill">
            <mat-label>Title</mat-label>
            <input matInput formControlName="title" />
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Text (plain)</mat-label>
            <input matInput formControlName="text" />
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Text color</mat-label>
            <input matInput formControlName="text_color" placeholder="#ffffff" />
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Label letter</mat-label>
            <input matInput formControlName="label_letter" maxlength="2" />
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Label color</mat-label>
            <input matInput formControlName="label_color" />
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Inline color</mat-label>
            <input matInput formControlName="inline_color" />
          </mat-form-field>

          <div class="imageRow">
            <div class="imgPick">
              <div class="label">Background image</div>
              <div class="thumb" *ngIf="form.controls['image_url'].value as url">
                <img [src]="toFullUrl(url)" alt="card bg" />
              </div>
              <div class="btns">
                <button type="button" mat-stroked-button (click)="pickImage()">Pick</button>
                <button type="button" mat-stroked-button (click)="clearImage()">Clear</button>
              </div>
            </div>
          </div>
        </div>

        <div class="actions">
          <button mat-flat-button color="primary" type="submit" [disabled]="form.invalid || !selectedDeckId() || saving()">
            {{ form.controls['id'].value ? 'Save changes' : 'Create card' }}
          </button>
          <button mat-button type="button" (click)="newCard()" [disabled]="!selectedDeckId() || loading()">Reset</button>
          <button mat-button color="warn" type="button" (click)="confirmDelete()" [disabled]="!form.controls['id'].value || deleting()">Delete</button>
        </div>
      </form>

      <!-- Preview (remove this block if you want no preview) -->
      <div class="preview">
        <h3>Preview</h3>
        <div class="previewBox">
          <app-project-card [card]="previewCard"></app-project-card>
        </div>
      </div>
    </div>
  </div>
</mat-card>

<ng-template #noSlug>
  <mat-card class="pcard-card"><p>No slug selected.</p></mat-card>
</ng-template>
