<div class="preview-host">
  <div class="page-content">
    @for (block of blocks; track block.id) {
      <div
        class="block-wrapper"
        [ngStyle]="{
          'background-color': block.backgroundColor,
          border: '2px solid ' + block.borderColor,
          'box-shadow': 'inset 0 0px 50px rgba(0,0,0,0.5)',
          'border-radius': '12px',
        }"
        [attr.data-tag]="block.tag || null"
      >
        <div class="grid-host">
          <div
            #gridRef
            class="grid-container"
            [ngStyle]="{
              display: 'grid',
              'grid-template-columns': block.gridTemplateColumns,
              'grid-template-rows': block.gridTemplateRows,
              gap: '1rem',
            }"
          >
            @for (content of block.content; track content.id) {
              @switch (content.type) {
                @case ('image') {
                  <img
                    [src]="content.url"
                    [attr.data-tag]="content.tag || null"
                    [alt]="content.alt || ''"
                    [ngStyle]="{
                      'grid-column': content.colStart + ' / span ' + (content.colSpan || 1),
                      'grid-row': content.rowStart + ' / span ' + (content.rowSpan || 1),
                      'border-radius': content.borderRadius || '8px',
                      margin: content.margin || 0,
                      padding: content.padding || 0,
                      width: content.width || '100%',
                      height: content.height || 'auto',
                      'object-fit': content.objectFit || 'cover',
                      'object-position': content.objectPosition || 'center',
                      overflow: content.overflow || 'hidden',
                    }"
                  />
                }
                @case ('text') {
                  <div
                    [ngStyle]="{
                      'grid-column': content.colStart + ' / span ' + (content.colSpan || 1),
                      'grid-row': content.rowStart + ' / span ' + (content.rowSpan || 1),
                      color: content.color || 'inherit',
                      display: 'flex',
                      'justify-content':
                        (content.horizontalAlign || 'left') === 'left'
                          ? 'flex-start'
                          : content.horizontalAlign === 'center'
                            ? 'center'
                            : 'flex-end',
                      'align-items':
                        (content.verticalAlign || 'top') === 'top'
                          ? 'flex-start'
                          : content.verticalAlign === 'center'
                            ? 'center'
                            : 'flex-end',
                      'text-align': content.textAlign || 'left',
                      margin: content.margin || 0,
                      padding: content.padding || 0,
                      'font-size': content.fontSize || 'inherit',
                      'font-weight': content.fontWeight || 'inherit',
                      'font-family': content.fontFamily || 'inherit',
                    }"
                  >
                    {{ content.text }}
                  </div>
                }
                @case ('link') {
                  <a
                    [href]="content.url"
                    target="_blank"
                    rel="noopener"
                    [ngStyle]="{
                      'grid-column': content.colStart + ' / span ' + (content.colSpan || 1),
                      'grid-row': content.rowStart + ' / span ' + (content.rowSpan || 1),
                      display: 'flex',
                      'justify-content':
                        (content.horizontalAlign || 'left') === 'left'
                          ? 'flex-start'
                          : content.horizontalAlign === 'center'
                            ? 'center'
                            : 'flex-end',
                      'align-items':
                        (content.verticalAlign || 'top') === 'top'
                          ? 'flex-start'
                          : content.verticalAlign === 'center'
                            ? 'center'
                            : 'flex-end',
                      gap: '8px',
                      'text-decoration': 'none',
                      color: content.color || 'inherit',
                      margin: content.margin || 0,
                      padding: content.padding || 0,
                      'font-size': content.fontSize || 'inherit',
                      'font-weight': content.fontWeight || 'inherit',
                      'font-family': content.fontFamily || 'inherit',
                    }"
                  >
                    @if (content.iconUrl && (content.iconPosition || 'left') === 'left') {
                      <img [src]="content.iconUrl" alt="icon" style="width: 24px; height: 24px" />
                    }
                    <span>{{ content.text }}</span>
                    @if (content.iconUrl && content.iconPosition === 'right') {
                      <img [src]="content.iconUrl" alt="icon" style="width: 24px; height: 24px" />
                    }
                  </a>
                }
              }
            }
          </div>

          <app-grid-overlay [target]="gridRef" [show]="showGrid"></app-grid-overlay>
        </div>
      </div>
    }
  </div>
</div>
